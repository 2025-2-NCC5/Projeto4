generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model customers {
  id         String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name       String
  email      String?
  phone      String?
  city       String?
  lat        Decimal?  @db.Decimal
  lon        Decimal?  @db.Decimal
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  orders     orders[]
}

model menu_items {
  id            String      @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  restaurant_id String      @db.Uuid
  name          String
  price         Decimal     @db.Decimal
  restaurants   restaurants @relation(fields: [restaurant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model order_items {
  id           String  @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  order_id     String  @db.Uuid
  menu_item_id String  @db.Uuid
  quantity     Int
  price        Decimal @db.Decimal
  orders       orders  @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model orders {
  id                    String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  restaurant_id         String        @db.Uuid
  customer_id           String        @db.Uuid
  order_value           Decimal       @db.Decimal
  delivery_time_minutes Int?
  rating                Int?
  nps_score             Int?
  created_at            DateTime?     @default(now()) @db.Timestamptz(6)
  order_items           order_items[]
  customers             customers     @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  restaurants           restaurants   @relation(fields: [restaurant_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([created_at], map: "idx_orders_created_at")
  @@index([customer_id], map: "idx_orders_customer")
  @@index([restaurant_id], map: "idx_orders_restaurant")
}

model restaurants {
  id         String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name       String
  city       String?
  created_at DateTime?    @default(now()) @db.Timestamptz(6)
  menu_items menu_items[]
  orders     orders[]
}
